:root {
  --bg-color: #f8f9fa;
  --text-color: #212529;
  --text-secondary: #6c757d;
  --plan-node-bg: #ffffff;
  --border-color: #dee2e6;
  --link-color: #00b5e2;
  --card-header-bg: #f8f9fa;
  --btn-light-bg: #f8f9fa;
  --btn-light-color: #212529;
  --subplan-name-bg: #b3d7d7;
  --node-h4-color: #000000;
  --edge-color: #808080;
  --cte-edge-color: #b3d7d7;
  --cte-rect-stroke: #cfcfcf;
  --highlight-bg: #ffffff;
  --connector-color: #cccccc;
}

[data-theme="dark"] {
  /* Use Bootstrap 5.3 variables for broad coverage */
  --bs-body-bg: #0f1115;
  --bs-body-color: #e1e1e6;
  --bs-tertiary-bg: #1a1c23; // Matches bg-light
  --bs-secondary-bg: #252831;
  --bs-border-color: #2d313d;
  --bs-border-color-translucent: rgba(255, 255, 255, 0.08);
  --bs-emphasis-color: #ffffff;
  --bs-secondary-color: #a0a6b5;
  --bs-tertiary-color: #6c757d;
  --bs-card-bg: #1a1c23;
  --bs-card-border-color: #2d313d;
  --bs-list-group-bg: #1a1c23;
  --bs-list-group-border-color: #2d313d;
  --bs-nav-tabs-link-active-bg: #1a1c23;
  --bs-nav-tabs-link-active-color: #ffffff;
  --bs-nav-tabs-border-color: #2d313d;
  --bs-nav-link-color: #a0a6b5;
  --bs-nav-link-hover-color: #ffffff;

  /* Custom variables for the app */
  --bg-color: #0d0f14;
  --text-color: #eef0f5;
  --text-secondary: #a0a6b5;
  --plan-node-bg: #22272e;
  --border-color: #30363d;
  --link-color: #00b5e2;
  --card-header-bg: #21252d;
  --btn-light-bg: #30363d;
  --btn-light-color: #eef0f5;
  --subplan-name-bg: #1c3d3d;
  --node-h4-color: #ffffff;
  --edge-color: #444c5e;
  --cte-edge-color: #2c5151;
  --cte-rect-stroke: #30363d;
  --highlight-bg: #252831;
  --connector-color: #444c5e;

  /* Force overrides for persistent Bootstrap utilities */
  .bg-light {
    background-color: var(--bs-tertiary-bg) !important;
  }
  .bg-white {
    background-color: var(--bs-card-bg) !important;
  }
  .text-dark {
    color: var(--bs-body-color) !important;
  }
  .text-secondary {
    color: var(--bs-secondary-color) !important;
  }
  .text-body-secondary {
    color: var(--bs-secondary-color) !important;
  }
  .btn-light {
    --bs-btn-bg: var(--btn-light-bg);
    --bs-btn-color: var(--btn-light-color);
    --bs-btn-border-color: var(--border-color);
    --bs-btn-hover-bg: #3d4452;
    --bs-btn-hover-color: #ffffff;
    --bs-btn-active-bg: #464f5e;
  }

  .card {
    background-color: var(--bs-card-bg);
    border-color: var(--bs-card-border-color);
  }

  .table {
    --bs-table-color: var(--bs-body-color);
    --bs-table-bg: transparent;
    --bs-table-border-color: var(--bs-border-color);
    --bs-table-hover-bg: rgba(255, 255, 255, 0.03);
    color: var(--bs-body-color);
  }

  .navbar {
    background-color: rgba(10, 11, 15, 0.7) !important;
    backdrop-filter: blur(20px) saturate(180%);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    position: sticky;
    top: 0;
    z-index: 1050;
  }

  /* MPV Specific adjustments */
  .plan-container {
    background-color: var(--bg-color);
  }

  .plan {
    background-color: var(--bg-color);
    // Even more subtle dots to not compete with nodes
    background-image: radial-gradient(
      circle,
      rgba(255, 255, 255, 0.05) 1px,
      transparent 1px
    );
    background-size: 30px 30px;
    background-attachment: local;
  }

  .plan-stats {
    background-color: rgba(9, 10, 13, 0.7);
    backdrop-filter: blur(8px);
    border-color: var(--bs-border-color) !important;
    color: var(--bs-secondary-color);
    .stat-value {
      color: var(--bs-emphasis-color);
    }
  }

  /* Left diagram view */
  .diagram,
  .plan-diagram {
    background-color: #0f1115;
    color: var(--text-color);
    border-right: 1px solid var(--border-color);

    .table-secondary {
      background-color: #1a1c23;
      color: var(--text-color);
    }

    .subplan {
      color: var(--bs-emphasis-color);
    }

    .node-index {
      color: var(--text-secondary);
    }

    .progress {
      background-color: #090a0d !important;
    }

    .btn-group {
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: #0f1115;
    }

    table {
      background-color: transparent !important;
      color: var(--text-color) !important;
      border-color: var(--border-color);
    }

    .table-secondary {
      background-color: #1a1c23 !important;
      color: var(--text-color) !important;
      border-bottom: 2px solid var(--border-color);
    }
  }

  .stats,
  .plan-grid {
    table {
      background-color: transparent !important;
      color: var(--text-color) !important;
      border-color: var(--border-color);
    }
  }

  .plan-grid {
    background-color: #0f1115;

    .node-index {
      background-color: #1a1c23;
      color: var(--text-secondary);
    }

    .grid-progress-cell {
      background-color: transparent;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
    }

    .node-type {
      b.bg-light {
        background-color: #3d4452 !important;
        color: #fff !important;
        border-color: #4d5462 !important;
      }
    }

    .tab-content.bg-white {
      background-color: #1a1c23 !important;
      border-color: var(--border-color) !important;
    }

    /* Subplan (CTE, Subquery) headers in grid */
    tr td.bg-light {
      background-color: #1a1c23 !important;
      color: var(--text-secondary) !important;
    }

    tr.node:hover {
      background-color: rgba(255, 255, 255, 0.03);
    }
  }

  .splitpanes__pane {
    background-color: var(--bg-color) !important;
  }

  /* Severity colors for dark mode - slightly more muted/glowing */
  .alert.c-1 {
    background-color: #2d313d;
    color: #a0a6b5;
    border: 1px solid #3d4452;
  }
  .alert.c-2 {
    background-color: #3d3b25;
    color: #fddb61;
    border: 1px solid #4d4929;
  }
  .alert.c-3 {
    background-color: #4d2d1a;
    color: #ffaa66;
    border: 1px solid #5d3d2a;
  }
  .alert.c-4 {
    background-color: #4d1a1a;
    color: #ff6666;
    border: 1px solid #5d2a2a;
  }

  .btn-outline-secondary {
    --bs-btn-color: var(--bs-secondary-color);
    --bs-btn-border-color: var(--border-color);
    --bs-btn-hover-bg: var(--bs-secondary-bg);
    --bs-btn-hover-border-color: var(--bs-secondary-color);
    --bs-btn-active-bg: var(--bs-secondary-bg);
    --bs-btn-active-border-color: var(--bs-secondary-color);
    &.active {
      background-color: #3d4452;
      color: #fff;
    }
  }

  .node-description {
    background-color: #1a1c23;
    border: 1px solid var(--border-color);
    color: #ccc;
    .node-type {
      background-color: var(--link-color);
    }
  }

  .stat-dropdown-container {
    background-color: #1a1c23 !important;
    border-color: #3d4452 !important;
    box-shadow: 0px 8px 24px rgba(0, 0, 0, 0.6) !important;
  }

  /* Fix for highlight.js in dark mode */
  pre code {
    background-color: #0d0d0d !important;
    color: #ffd180;
  }

  /* Premium Node styling */
  .plan-node {
    .plan-node-body {
      // Lighter and less transparent for better visibility
      background-color: #2d333b !important;
      background-image: linear-gradient(
        180deg,
        rgba(255, 255, 255, 0.03) 0%,
        transparent 100%
      );
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.12) !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5) !important;
      transition:
        transform 0.2s cubic-bezier(0.2, 0, 0, 1),
        box-shadow 0.2s ease,
        border-color 0.2s ease;
    }

    &.selected .plan-node-body {
      border-color: var(--link-color) !important;
      box-shadow:
        0 0 20px rgba(0, 181, 226, 0.4),
        0 8px 32px rgba(0, 0, 0, 0.6) !important;
      transform: translateY(-2px) scale(1.02);
    }

    &.highlight .plan-node-body {
      border-color: rgba(255, 255, 255, 0.3) !important;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.15) !important;
    }
  }

  /* Ultra-Premium Edge Styling (The thick lines) */
  path.edge {
    stroke: rgba(110, 118, 129, 0.4) !important; // Brighter default
    stroke-width: 12px;
    transition:
      stroke 0.3s ease,
      stroke-width 0.3s ease;

    &:hover {
      stroke: rgba(0, 181, 226, 0.6) !important;
      stroke-width: 14px;
    }
  }

  /* CTE containers in diagram */
  rect.cte-container {
    fill: rgba(0, 181, 226, 0.05) !important;
    stroke: rgba(0, 181, 226, 0.2) !important;
    stroke-dasharray: 5, 5;
  }

  /* Splitpanes splitter */
  .splitpanes--vertical > .splitpanes__splitter {
    background-color: #050608;
    border-left: 1px solid var(--border-color);
    width: 6px;
    position: relative;

    &:hover {
      background-color: #111;
    }

    &::before {
      content: "";
      position: absolute;
      left: 2px;
      top: 50%;
      height: 40px;
      width: 2px;
      background: #333;
      transform: translateY(-50%);
      border-radius: 4px;
    }
  }
}

/* Smooth transition for theme switching */
body {
  transition:
    background-color 0.3s ease,
    color 0.3s ease;
}
.plan-node,
.plan-container,
.navbar,
.plan-stats,
.card,
.btn {
  transition:
    background-color 0.3s ease,
    border-color 0.3s ease,
    color 0.3s ease,
    box-shadow 0.3s ease;
}
